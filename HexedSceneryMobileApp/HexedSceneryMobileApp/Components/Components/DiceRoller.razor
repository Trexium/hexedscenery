@using Services
@using HexedSceneryMobileApp.Helpers
@using HexedSceneryMobileApp.Models

@inject IDiceRollHelper DiceRollHelper
@inject IDiceService DiceService

@if (_diceType == null)
{
    <span>Loading...</span>
}
else
{
    <div style="flex-direction: row;" class="d-flex">
        <MudTextField T="int?" DebounceInterval="500" Value=@_diceResult Label="@_label" Variant="@Variant.Text" OnDebounceIntervalElapsed="ManualDiceResultInput" />
        <MudIconButton OnClick="Roll" Icon="@Icons.Material.Filled.Casino" aria-label="shuffle" />
    </div>
}




@code {
    [Parameter]
    public int DiceTypeId { get; set; }
    [Parameter]
    public int NumberOfDice { get; set; }
    [Parameter]
    public EventCallback<Roll> OnNewResult { get; set; }

    private int? _diceResult;
    private Roll? _result;

    private DiceType _diceType { get; set; }
    private string _label;

    public async Task Roll()
    {
        _result = await DiceRollHelper.Roll(_diceType, NumberOfDice);
        _diceResult = _result.ResultNumber;

        await OnNewResult.InvokeAsync(_result);

        StateHasChanged();
    }

    public async Task ClearResult()
    {
        _diceResult = null;
    }

    protected override async Task OnParametersSetAsync()
    {
        _diceType = await DiceService.GetDiceTypeAsync(DiceTypeId);
        _label = $"Roll {NumberOfDice}{_diceType.DisplayName} and enter the result or push the button to roll the dice";
    }

    private void ManualDiceResultInput(string value)
    {
        if (_result != null)
        {
            OnNewResult.InvokeAsync(_result);
        }
    }
}